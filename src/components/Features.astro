---
import type { Lang } from "../i18n/translations";
import { useTranslations } from "../i18n/utils";

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const features = [
  {
    title: t("features.gpu.title"),
    description: t("features.gpu.desc"),
    icon: "bolt",
    span: "md:col-span-2",
  },
  {
    title: t("features.transforms.title"),
    description: t("features.transforms.desc"),
    icon: "layers",
    span: "",
  },
  {
    title: t("features.pipelines.title"),
    description: t("features.pipelines.desc"),
    icon: "nodes",
    span: "",
  },
  {
    title: t("features.shaders.title"),
    description: t("features.shaders.desc"),
    icon: "code",
    span: "md:col-span-2",
  },
  {
    title: t("features.textures.title"),
    description: t("features.textures.desc"),
    icon: "image",
    span: "",
  },
  {
    title: t("features.pbr.title"),
    description: t("features.pbr.desc"),
    icon: "sparkle",
    span: "",
  },
  {
    title: t("features.raytracing.title"),
    description: t("features.raytracing.desc"),
    icon: "target",
    span: "",
  },
];

/* Nucleo Sharp Essential — SVG inner HTML extracted from npm package (24x24 viewBox) */
const iconSvg: Record<string, string> = {
  /* IconBoltLightning — GPU Fundamentals */
  bolt: `<path d="M13 8.00004H20V9.00004L11 22L9.5 22L11 14H5L7.5 2H14L13 8.00004Z" stroke="currentColor" stroke-width="2" stroke-linecap="square" fill="none"/>`,
  /* IconLayers3 — 3D Transforms */
  layers: `<path d="M22 6.5V7.163L12 11.627L2 7.163V6.5L12 2.035L22 6.5Z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M11.596 15.54L12.004 15.723L12.411 15.54L23 10.809V12.998L22.407 13.262L12.407 17.727L12 17.909L11.593 17.727L1.592 13.262L1 12.998V10.808L11.596 15.54Z" fill="currentColor"/><path d="M3.001 16.886L5.239 17.886L11.596 20.725L12.004 20.907L12.411 20.725L20.367 17.169L21.001 16.887L21 16.886L23 15.993V18.185L22.407 18.448L12.407 22.913L12 23.095L11.592 22.913L1.592 18.448L1 18.184V15.992L3.001 16.886Z" fill="currentColor"/>`,
  /* IconNodes — Render Pipelines */
  nodes: `<path d="M6.119 6.187C6.262 6.893 6.532 7.572 6.918 8.188C5.729 9.444 5 11.136 5 13C5 13.374 5.029 13.741 5.085 14.098L4.098 14.253L3.109 14.408C3.037 13.949 3 13.478 3 13C3 10.277 4.21 7.836 6.119 6.187Z" fill="currentColor"/><path d="M17.559 18.798L18.184 19.578L17.625 20.025C16.085 21.26 14.127 22 12 22C10.677 22 9.417 21.713 8.283 21.198C8.76 20.712 9.155 20.145 9.445 19.519C10.236 19.829 11.097 20 12 20C13.656 20 15.176 19.426 16.374 18.465L16.933 18.018L17.559 18.798Z" fill="currentColor"/><path d="M15.139 4.563C17.968 5.616 20.125 8.052 20.787 11.052C20.109 10.963 19.419 10.99 18.748 11.133C18.149 8.964 16.532 7.216 14.441 6.438L15.139 4.563Z" fill="currentColor"/><circle cx="12" cy="5" r="3" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="4" cy="17" r="3" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="20" cy="17" r="3" stroke="currentColor" stroke-width="2" fill="none"/>`,
  /* IconBracketsCurlyDots — Shader */
  code: `<path d="M12 16.01V16" stroke="currentColor" stroke-width="2" stroke-linecap="square" fill="none"/><path d="M16 16.01V16" stroke="currentColor" stroke-width="2" stroke-linecap="square" fill="none"/><path d="M8 16.01V16" stroke="currentColor" stroke-width="2" stroke-linecap="square" fill="none"/><path d="M17 3H20V6.646C20 8.702 21.161 10.581 23 11.5V12.5C21.161 13.419 20 15.299 20 17.354V21H17" stroke="currentColor" stroke-width="2" stroke-linecap="square" fill="none"/><path d="M7 3H4V6.646C4 8.702 2.839 10.581 1 11.5V12.5C2.839 13.419 4 15.299 4 17.354V21H7" stroke="currentColor" stroke-width="2" stroke-linecap="square" fill="none"/>`,
  /* IconImage — Textures & Sampling */
  image: `<path d="M21 18L17 13H16L9.5 21" stroke="currentColor" stroke-width="2" stroke-miterlimit="10" fill="none"/><circle cx="9.5" cy="9.5" r="2.5" stroke="currentColor" stroke-width="2" fill="none"/><rect x="3" y="3" width="18" height="18" stroke="currentColor" stroke-width="2" stroke-miterlimit="10" stroke-linecap="square" fill="none"/>`,
  /* IconSparkle3 — PBR Rendering */
  sparkle: `<path d="M15.7 15.7L22 13.45V12.55L15.7 10.3L13.45 4H12.55L10.3 10.3L4 12.55V13.45L10.3 15.7L12.55 22H13.45L15.7 15.7Z" stroke="currentColor" stroke-width="2" stroke-miterlimit="10" stroke-linecap="square" fill="none"/><path d="M6.172 6.172L8 5.341V4.659L6.172 3.828L5.341 2H4.659L3.828 3.828L2 4.659V5.341L3.828 6.172L4.659 8H5.341L6.172 6.172Z" fill="currentColor"/>`,
  /* IconTarget — Ray Tracing */
  target: `<path d="M22 12C22 17.523 17.523 22 12 22C6.477 22 2 17.523 2 12C2 6.477 6.477 2 12 2" stroke="currentColor" stroke-width="2" stroke-miterlimit="10" stroke-linecap="square" fill="none"/><path d="M12 12L18 6" stroke="currentColor" stroke-width="2" stroke-linecap="square" fill="none"/><path d="M18 12C18 15.314 15.314 18 12 18C8.686 18 6 15.314 6 12C6 8.686 8.686 6 12 6" stroke="currentColor" stroke-width="2" stroke-miterlimit="10" stroke-linecap="square" fill="none"/><path d="M18 2V6H22" stroke="currentColor" stroke-width="2" stroke-linecap="square" fill="none"/>`,
};
---

<section id="features" class="relative py-32 bg-bg-primary">
  <div class="mx-auto max-w-7xl px-6">
    <!-- Section header -->
    <div class="mb-24 animate-on-scroll">
      <h2 class="text-4xl md:text-6xl font-bold tracking-tighter mb-6">
        {t("features.heading")}
      </h2>
      <p class="text-xl text-text-secondary max-w-xl font-light">
        {t("features.subtitle")}
      </p>
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 bg-border-primary border border-border-primary gap-[1px] animate-on-scroll stagger-children">
      {features.map((feature) => (
        <div
          class:list={[
            "group relative bg-bg-primary p-10 transition-all duration-500 hover:z-10 hover:shadow-2xl",
            feature.span
          ]}
        >
          <div class="relative z-10 h-full flex flex-col justify-between">
            <div>
              {/* Nucleo Sharp Icon */}
              <div class="mb-8 inline-flex items-center justify-center w-12 h-12 text-text-primary group-hover:scale-110 transition-transform duration-500">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" set:html={iconSvg[feature.icon]} />
              </div>

              {/* Title */}
              <h3 class="text-2xl font-bold text-text-primary mb-4 tracking-tight">
                {feature.title}
              </h3>

              {/* Description */}
              <p class="text-text-secondary leading-relaxed font-light">
                {feature.description}
              </p>
            </div>
            
            <div class="mt-8 pt-8 border-t border-border-primary opacity-0 group-hover:opacity-100 transition-all duration-500">
               <span class="text-xs font-mono uppercase tracking-widest text-text-primary">Learn more -></span>
            </div>
          </div>
          
          <!-- Invert hover effect background -->
          <div class="absolute inset-0 bg-text-primary opacity-0 group-hover:opacity-5 transition-opacity duration-300 pointer-events-none"></div>
        </div>
      ))}
    </div>
  </div>
</section>
